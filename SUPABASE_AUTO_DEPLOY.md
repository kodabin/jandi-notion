# Supabase ìë™ ë°°í¬ ê°€ì´ë“œ

## ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” **GitHub Actions**ë¥¼ í†µí•´ Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ìë™ìœ¼ë¡œ ë°°í¬í•©ë‹ˆë‹¤.

**master/main ë¸Œëœì¹˜ì— push**í•  ë•Œë§ˆë‹¤:
1. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
2. **Supabase ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìë™ ì‹¤í–‰** âœ¨
3. Vercelì— ìë™ ë°°í¬

---

## ì„¤ì • ë°©ë²•

### 1ë‹¨ê³„: Supabase Access Token ë°œê¸‰

#### 1-1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì†
https://app.supabase.com ë¡œê·¸ì¸

#### 1-2. Access Token ìƒì„±
1. ìš°ì¸¡ ìƒë‹¨ í”„ë¡œí•„ ì•„ì´ì½˜ í´ë¦­
2. **"Account Settings"** ì„ íƒ
3. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **"Access Tokens"** í´ë¦­
4. **"Generate New Token"** í´ë¦­
5. Token ì´ë¦„ ì…ë ¥: `GitHub Actions Deploy`
6. **"Generate Token"** í´ë¦­
7. ìƒì„±ëœ í† í°ì„ ë³µì‚¬ (âš ï¸ ë‹¤ì‹œ ë³¼ ìˆ˜ ì—†ìœ¼ë‹ˆ ì•ˆì „í•œ ê³³ì— ì €ì¥!)

```
ì˜ˆì‹œ: sbp_1234567890abcdefghijklmnopqrstuvwxyz...
```

---

### 2ë‹¨ê³„: Supabase í”„ë¡œì íŠ¸ ì •ë³´ í™•ì¸

#### 2-1. í”„ë¡œì íŠ¸ ID í™•ì¸
1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ í”„ë¡œì íŠ¸ ì„ íƒ
2. **Settings** â†’ **General** í´ë¦­
3. **Reference ID** ë³µì‚¬

```
ì˜ˆì‹œ: abcdefghijklmnop
```

#### 2-2. ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ì„¤ì •í–ˆë˜ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”.

ë§Œì•½ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë ¸ë‹¤ë©´:
1. **Settings** â†’ **Database** í´ë¦­
2. **"Reset Database Password"** í´ë¦­
3. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

---

### 3ë‹¨ê³„: GitHub Secrets ì„¤ì •

#### 3-1. GitHub ì €ì¥ì†Œ ì ‘ì†
https://github.com/[YOUR_USERNAME]/jandi-notion-webhook

#### 3-2. Secrets ì¶”ê°€
1. **Settings** â†’ **Secrets and variables** â†’ **Actions** í´ë¦­
2. **"New repository secret"** í´ë¦­
3. ë‹¤ìŒ 3ê°œì˜ secret ì¶”ê°€:

| Name | Value | ì„¤ëª… |
|------|-------|------|
| `SUPABASE_ACCESS_TOKEN` | `sbp_1234...` | 1ë‹¨ê³„ì—ì„œ ë°œê¸‰ë°›ì€ Access Token |
| `SUPABASE_PROJECT_ID` | `abcdefghijklmnop` | 2ë‹¨ê³„ì—ì„œ í™•ì¸í•œ Project Reference ID |
| `SUPABASE_DB_PASSWORD` | `MySecureP@ssw0rd` | 2ë‹¨ê³„ì—ì„œ í™•ì¸í•œ DB ë¹„ë°€ë²ˆí˜¸ |

---

### 4ë‹¨ê³„: ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸

#### 4-1. ì½”ë“œ ë³€ê²½ ë° Push
```bash
# ê°„ë‹¨í•œ ë³€ê²½ì‚¬í•­ ì¶”ê°€
echo "# Test Auto Deploy" >> README.md

# Git ì»¤ë°‹ ë° í‘¸ì‹œ
git add .
git commit -m "test: Supabase ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸"
git push origin master
```

#### 4-2. GitHub Actions í™•ì¸
1. GitHub ì €ì¥ì†Œ â†’ **Actions** íƒ­
2. ìµœê·¼ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
3. "Run Supabase migrations" ë‹¨ê³„ê°€ ì„±ê³µí•˜ëŠ”ì§€ í™•ì¸

```
âœ… Run Supabase migrations
   Linked to project ref: abcdefghijklmnop
   Applying migration: 20250127000000_initial_schema.sql
   Migration applied successfully!
```

#### 4-3. Supabase ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
1. Supabase ëŒ€ì‹œë³´ë“œ â†’ **Table Editor**
2. `webhooks`, `logs`, `webhook_steps` í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì¶”ê°€ ë°©ë²•

### ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±

ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•˜ë ¤ë©´:

#### 1. ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
```bash
# íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹ìœ¼ë¡œ íŒŒì¼ëª… ìƒì„±
# í˜•ì‹: YYYYMMDDHHMMSS_ì„¤ëª….sql
```

ì˜ˆì‹œ:
```bash
supabase/migrations/20250127120000_add_user_table.sql
```

#### 2. SQL ì‘ì„±
```sql
-- ì‚¬ìš©ì í…Œì´ë¸” ì¶”ê°€
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT NOT NULL UNIQUE,
  name TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
```

#### 3. Gitì— ì»¤ë°‹ ë° í‘¸ì‹œ
```bash
git add supabase/migrations/20250127120000_add_user_table.sql
git commit -m "feat: Add users table migration"
git push origin master
```

#### 4. ìë™ ë°°í¬ í™•ì¸
GitHub Actionsê°€ ìë™ìœ¼ë¡œ:
1. ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ê°ì§€
2. Supabase ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©
3. Vercelì— ë°°í¬

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ìˆœì„œ

ë§ˆì´ê·¸ë ˆì´ì…˜ì€ **íŒŒì¼ëª… ìˆœì„œëŒ€ë¡œ** ì‹¤í–‰ë©ë‹ˆë‹¤:

```
supabase/migrations/
â”œâ”€â”€ 20250127000000_initial_schema.sql      â† 1ë²ˆ ì‹¤í–‰
â”œâ”€â”€ 20250127120000_add_user_table.sql      â† 2ë²ˆ ì‹¤í–‰
â””â”€â”€ 20250128100000_add_permissions.sql     â† 3ë²ˆ ì‹¤í–‰
```

âš ï¸ **ì¤‘ìš”**:
- íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹ì„ ê¼­ ì§€ì¼œì£¼ì„¸ìš” (YYYYMMDDHHmmss)
- í•œ ë²ˆ ì‹¤í–‰ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”
- ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì€ í•­ìƒ ìƒˆ íŒŒì¼ë¡œ ìƒì„±í•˜ì„¸ìš”

---

## ë¡œì»¬ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸

ë°°í¬ ì „ì— ë¡œì»¬ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´:

### 1. Supabase CLI ì„¤ì¹˜
```bash
npm install -g supabase
```

### 2. Supabase í”„ë¡œì íŠ¸ ì—°ê²°
```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
supabase link --project-ref YOUR_PROJECT_ID
```

### 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
supabase db push

# ë˜ëŠ” íŠ¹ì • ë§ˆì´ê·¸ë ˆì´ì…˜ë§Œ ì‹¤í–‰
supabase migration up
```

### 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
```bash
# ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ëª©ë¡ í™•ì¸
supabase migration list
```

---

## ë¬¸ì œ í•´ê²°

### Q1: "Authentication failed" ì—ëŸ¬
**ì›ì¸**: Access Tokenì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ë§Œë£Œë¨

**í•´ê²°**:
1. Supabaseì—ì„œ ìƒˆ Access Token ë°œê¸‰
2. GitHub Secretsì˜ `SUPABASE_ACCESS_TOKEN` ì—…ë°ì´íŠ¸

### Q2: "Project not found" ì—ëŸ¬
**ì›ì¸**: Project IDê°€ ì˜ëª»ë¨

**í•´ê²°**:
1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ Reference ID ë‹¤ì‹œ í™•ì¸
2. GitHub Secretsì˜ `SUPABASE_PROJECT_ID` ì—…ë°ì´íŠ¸

### Q3: "Password authentication failed" ì—ëŸ¬
**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë¨

**í•´ê²°**:
1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
2. GitHub Secretsì˜ `SUPABASE_DB_PASSWORD` ì—…ë°ì´íŠ¸

### Q4: ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
**ì›ì¸**: PR ë°°í¬ ì‹œì—ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
- ë§ˆì´ê·¸ë ˆì´ì…˜ì€ **master/main ë¸Œëœì¹˜ì— pushë  ë•Œë§Œ** ì‹¤í–‰ë©ë‹ˆë‹¤
- PRì„ ë¨¸ì§€í•œ í›„ í™•ì¸í•˜ì„¸ìš”

### Q5: "Migration already applied" ê²½ê³ 
**ì •ìƒ**: ì´ë¯¸ ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ìŠ¤í‚µë©ë‹ˆë‹¤

---

## ì›Œí¬í”Œë¡œìš° êµ¬ì¡°

### GitHub Actions íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì½”ë“œ Push (master/main)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì½”ë“œ ì²´í¬ì•„ì›ƒ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Node.js ë° ì˜ì¡´ì„± ì„¤ì¹˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Supabase CLI ì„¤ì¹˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Supabase í”„ë¡œì íŠ¸ ì—°ê²°          â”‚
â”‚     (supabase link)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰   â”‚
â”‚     (supabase db push)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Vercel ë°°í¬                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… ë°°í¬ ì™„ë£Œ!                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ Best Practices

### âœ… ê¶Œì¥ì‚¬í•­
1. **ë©±ë“±ì„±(Idempotency)**: `CREATE TABLE IF NOT EXISTS` ì‚¬ìš©
2. **ìˆœì°¨ ì‹¤í–‰**: íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ íŒŒì¼ëª… ì •ë ¬
3. **ì‘ì€ ë‹¨ìœ„**: í•˜ë‚˜ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ì— í•˜ë‚˜ì˜ ë³€ê²½ì‚¬í•­
4. **ë¡¤ë°± ê³„íš**: í•„ìš”ì‹œ ë¡¤ë°± ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„
5. **í…ŒìŠ¤íŠ¸**: ë¡œì»¬ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸ í›„ ë°°í¬

### âŒ í”¼í•´ì•¼ í•  ê²ƒ
1. ê¸°ì¡´ ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆ˜ì •
2. í”„ë¡œë•ì…˜ ë°ì´í„° ì‚­ì œ (DROP TABLE ì£¼ì˜)
3. íƒ€ì„ìŠ¤íƒ¬í”„ ì—†ëŠ” íŒŒì¼ëª…
4. ë„ˆë¬´ í° ë§ˆì´ê·¸ë ˆì´ì…˜ (ì—¬ëŸ¬ í…Œì´ë¸” ë™ì‹œ ë³€ê²½)

---

## í™˜ê²½ë³„ ë°°í¬ ì „ëµ

### Production (master/main ë¸Œëœì¹˜)
- âœ… Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- âœ… Vercel Production ë°°í¬

### Preview (Pull Request)
- âŒ Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì•ˆ í•¨ (Production DB ë³´í˜¸)
- âœ… Vercel Preview ë°°í¬ë§Œ ì‹¤í–‰

---

## ì°¸ê³  ìë£Œ

- [Supabase CLI ë¬¸ì„œ](https://supabase.com/docs/guides/cli)
- [Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ](https://supabase.com/docs/guides/cli/managing-migrations)
- [GitHub Actions ë¬¸ì„œ](https://docs.github.com/en/actions)

---

**ì„¤ì • ì™„ë£Œ!** ì´ì œ ì½”ë“œë¥¼ í‘¸ì‹œí•  ë•Œë§ˆë‹¤ Supabase ë°ì´í„°ë² ì´ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤! ğŸš€
